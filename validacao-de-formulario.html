<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS | Aula II</title>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.12.0/css/all.css" integrity="sha384-ekOryaXPbeCpWQNxMwSWVvQ0+1VrStoPJq54shlYhR8HzQgig1v5fas6YgOqLoKz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="./index.html">JS | AULA II</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menuContent" aria-controls="menuContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="menuContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./dom.html">DOM</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./js-e-css.html">JS e CSS</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./eventos-js.html">Eventos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./timing-events.html">Timing Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./prevent-default.html">preventDefault()</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./validacao-de-formulario.html">Validação de Formulário</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
<main class="container">
    <section class="row py-5">
        <header class="col-12 p-3 mx-auto mb-4 row">
            <h1 class="col-12 text-center mb-5">Validação de Formulário</h1>
            <img class="col-12 col-lg-6 mx-auto rounded" src="./assets/img/validacao-formulario.png" alt="Eventos de Tempo" width="100%" height="auto">
            <article class="col-12 col-lg-6 mx-auto">
                <h2 class="col-12 mb-3">Como validar um form?</h2>
                <p class="col-12">Chegou a hora da gente aplicar tudo o que vimos até o momento em uma prática mais 'real'. Usando eventos, manipulação do DOM, aplicação de estilos, seletores, condicionais, etc..</p>
                <p class="col-12">Vamos incrementar e validar um formulário HTML (mas sem validações HTML5). Já há uma base pronta para a gente poder focar no que interessa. Então vamos pra cima!</p>
            </article>
        </header>
        <article class="col-12 mx-auto my-4">
            <h2 class="col-12">Prática 24 | Validação de Formulário</h2>
            <ul class="col-12 py-3">
                <li class="my-5">
                    <h5>Instruções</h5>
                    <p class="mt-3">A seguir temos um formulário montado com a ajuda do Bootstrap. Precisaremos realizar as seguintes tarefas:</p>
                    <ol class="col-12 font-weight-bold">
                        <li class="mb-3">Incluir cada uma das UFs no select do form</li>
                        <li class="mb-3">Verificar se o campo de email foi preenchido corretamente (se possui @)</li>
                        <li class="mb-3">Verificar se a confirmação de email coincide com o primeiro email</li>
                        <li class="mb-3">Verificar se a senha possui letra maiúscula, minúscula, número, ao menos 6 caracteres e não contém espaço</li>
                        <li class="mb-3">Verificar se a confirmação de senha coincide com a primeira senha</li>
                        <li class="mb-3">Preencher o endereço a partir do CEP</li>
                        <li class="mb-3">Evitar que o disparo do formulário seja efetuado sem que todos os campos estejam preenchidos</li>
                        <li class="mb-3">Confirmar os principais campos preenchidos (nome, sobrenome, email e CEP) numa caixa de diálogo do browser</li>
                        <li class="mb-3">Caso o usuário confirme todos os dados, abrir uma nova guia com um texto de confirmação de envio de mensagem</li>
                    </ol>
                    <div class="bg-light p-5">
                        <form id="meuForm" method="post" action="">
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="nome">Nome</label>
                                    <input type="text" class="form-control" id="nome" name="nome" placeholder="Fulano">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="sobrenome">Sobrenome</label>
                                    <input type="text" class="form-control" id="sobrenome" name="sobrenome" placeholder="da Silva">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="email">Email</label>
                                    <input type="text" class="form-control" id="email" name="email" placeholder="exemplo@email.com">
                                    <small id="emailError" class="d-none text-danger">Por favor, confira o email inserido</small>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="emailConfirm">Confirmação de email</label>
                                    <input type="text" class="form-control" id="emailConfirm" name="emailConfirm" placeholder="exemplo@email.com">
                                    <small id="emailConfirmError" class="d-none text-danger">Atenção, os emails inseridos não coincidem</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="senha">Senha</label>
                                    <input type="text" class="form-control" id="senha" name="senha" placeholder="*****" aria-describedby="senhaHelp">
                                    <small id="passwordHelpInline" class="text-muted">
                                        [<span id="senha6chars">Tem mais de 5 caracteres e não tem espaço</span> |
                                        <span id="senhaAlphaNum">Tem números, maiúsculas e minúsculas</span>]
                                    </small>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="senhaConfirm">Confirmação de Senha</label>
                                    <input type="text" class="form-control" id="senhaConfirm" name="senhaConfirm" placeholder="*****" aria-describedby="senhaConfirmHelp">
                                    <small id="senhaConfirmError" class="d-none text-danger">
                                        <span>Atenção: essa senha não coincide com a anterior</span>
                                    </small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="cep">CEP</label>
                                    <input type="text" class="form-control" id="cep" name="cep">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="cidade">Cidade</label>
                                    <input type="text" class="form-control" id="cidade" name="cidade">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="uf">UF</label>
                                    <select id="uf" class="form-control">
                                        <option disabled selected value="">UF</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="endereco">Endereço</label>
                                <input type="text" class="form-control" id="endereco" placeholder="Avenida Brasil">
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label for="numero">Número</label>
                                    <input type="text" class="form-control" id="numero" name="numero" placeholder="234">
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="complemento">Complemento</label>
                                    <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Apto. 32">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="bairro">Bairro</label>
                                    <input type="text" class="form-control" id="bairro" name="bairro" placeholder="Centro">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="btnEnviar">Enviar</button>
                        </form>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Criando os seletores</h5>
                    <p class="mt-3">Vamos deixar todos os seletores criados para depois focarmos em cada validação.</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            const formulario = document.querySelector('#meuForm')<br />
                            const nome = document.querySelector('#nome')<br />
                            const sobrenome = document.querySelector('#sobrenome')<br />
                            const email = document.querySelector('#email')<br />
                            const emailConfirm = document.querySelector('#emailConfirm')<br />
                            const cep = document.querySelector('#cep')<br />
                            const cidade = document.querySelector('#cidade')<br />
                            const estado = document.querySelector('#uf')<br />
                            const bairro = document.querySelector('#bairro')<br />
                            const endereco = document.querySelector('#endereco')<br />
                            const numero = document.querySelector('#numero')<br />
                            const complemento = document.querySelector('#complemento')<br />
                            const senha = document.querySelector('#senha')<br />
                            const senha6chars = document.querySelector('#senha6chars')<br />
                            const senhaAlphaNum = document.querySelector('#senhaAlphaNum')<br />
                            const senhaSpecialChars = document.querySelector('#senhaSpecialChars')<br />
                            const senhaConfirm = document.querySelector('#senhaConfirm')<br />
                            const senhaConfirmEqual = document.querySelector('#senhaConfirmEqual')<br />
                            const btnEnviar = document.querySelector('#btnEnviar')
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Incluindo UFs disponíveis</h5>
                    <p class="mt-3">Vamos definir cada <code>option</code> para as UFs.</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            ufs = ['AC','AL','AM','AP','BA','CE','DF','ES','GO','MA','MG','MS','MT','PA','PB','PE','PI','PR','RJ','RN','RO','RR','RS','SC','SE', 'SP', 'TO']<br /><br />
                            for(let uf of ufs) {<br />
                            <span class="ml-3">estado.innerHTML += `</span><br />
                            <span class="ml-5">&lt;option value="${uf}"&gt;${uf}&lt;/option&gt;</span><br />
                            <span class="ml-3">`</span><br />
                            }
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Verificando email</h5>
                    <p class="mt-3">Vamos validar o email (se há <i>@</i>).</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            email.onblur = e => {<br />
                            <span class="ml-3">if ( e.target.value.includes('@') === false ) {</span><br />
                            <span class="ml-5">e.target.focus()</span><br />
                            <span class="ml-5">e.target.classList.add('text-danger')</span><br />
                            <span class="ml-5">emailError.classList.remove('d-none')</span><br />
                            <span class="ml-5">(emailConfirm.value !== '' && emailConfirm.value !== email.value)<br /> ? emailConfirmError.classList.remove('d-none')<br /> : emailConfirmError.classList.add('d-none')</span><br />
                            <span class="ml-3">} else {</span><br />
                            <span class="ml-3">e.target.classList.remove('text-danger')</span><br />
                            <span class="ml-5">emailError.classList.add('d-none')</span><br />
                            <span class="ml-3">}</span><br />
                            }
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Verificando confirmação de email</h5>
                    <p class="mt-3">Vamos validar o email confirmado (se é igual ao primeiro email).</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            emailConfirm.onblur = e => {<br />
                            <span class="ml-3">if ( e.target.value !== email.value ) {</span><br />
                            <span class="ml-5">e.target.focus()</span><br />
                            <span class="ml-5">e.target.classList.add('text-danger')</span><br />
                            <span class="ml-5">emailConfirmError.classList.remove('d-none')</span><br />
                            <span class="ml-3">} else {</span><br />
                            <span class="ml-3">e.target.classList.remove('text-danger')</span><br />
                            <span class="ml-5">emailConfirmError.classList.add('d-none')</span><br />
                            <span class="ml-3">}</span><br />
                            }
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Verificando senha</h5>
                    <p class="mt-3">Vamos validar a senha (as 5 condições - maiúsculas, minúsculas, números, sem espaço e 6 caracteres no mínimo). Para isso usaremos um pouquinho de <i>Regular Expressions</i> - ou <i>RegExp</i>.</p>
                    <p class="mt-3">Vale destacar que há formas mais sucintas para usarmos o <i>RegExp</i> (bem como poderíamos criar uma função para validar tudo de uma só vez), mas... a ideia é repetirmos alguns dos comandos para que fiquem bem claros, por isso faremos de uma maneira mais repetitiva e menos prática.</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            temMaiuscula = /[+A-Z]/<br />
                            temMinuscula = /[+a-z]/<br />
                            temNumero = /[+0-9]/<br />
                            naoTemEspaco = /\S{6,}/<br />
                            senha.onblur = e => {<br /><br />
                            <span class="ml-3">let senha = e.target.value</span><br />
                            <span class="ml-3">if ( temMaiuscula.test(senha) && temMinuscula.test(senha) && temNumero.test(senha) && naoTemEspaco.test(senha) ) {</span><br />
                            <span class="ml-5">e.target.classList.remove('text-danger')</span><br />
                            <span class="ml-3">} else {</span><br />
                            <span class="ml-5">e.target.focus()</span><br />
                            <span class="ml-5">e.target.classList.add('text-danger')</span><br />
                            <span class="ml-3">}</span><br />
                            <span class="ml-3">if ( temMaiuscula.test(senha) && temMinuscula.test(senha) && temNumero.test(senha) ) {</span><br />
                            <span class="ml-5">senhaAlphaNum.classList.add('text-success')</span><br />
                            <span class="ml-5">senhaAlphaNum.classList.remove('text-danger')</span><br />
                            <span class="ml-3">} else {</span><br />
                            <span class="ml-5">senhaAlphaNum.classList.add('text-danger')</span><br />
                            <span class="ml-5">senhaAlphaNum.classList.remove('text-success')</span><br />
                            <span class="ml-3">}</span><br />
                            <span class="ml-3">if ( naoTemEspaco.test(senha) ) {</span><br />
                            <span class="ml-5">senha6chars.classList.add('text-success')</span><br />
                            <span class="ml-5">senha6chars.classList.remove('text-danger')</span><br />
                            <span class="ml-3">} else {</span><br />
                            <span class="ml-5">senha6chars.classList.add('text-danger')</span><br />
                            <span class="ml-5">senha6chars.classList.remove('text-success')</span><br />
                            <span class="ml-3">}</span><br /><br />
                            }
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Verificando confirmação de senha</h5>
                    <p class="mt-3">Vamos validar a senha confirmada (se é igual à primeira senha).</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            senhaConfirm.onblur = e => {<br />
                            <span class="ml-3">if ( e.target.value !== senha.value ) {</span><br />
                            <span class="ml-5">e.target.focus()</span><br />
                            <span class="ml-5">e.target.classList.add('text-danger')</span><br />
                            <span class="ml-5">senhaConfirmError.classList.remove('d-none')</span><br />
                            <span class="ml-3">} else {</span><br />
                            <span class="ml-3">e.target.classList.remove('text-danger')</span><br />
                            <span class="ml-5">senhaConfirmError.classList.add('d-none')</span><br />
                            <span class="ml-3">}</span><br />
                            }
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Evitando o disparo da mensagem</h5>
                    <p class="mt-3">Vamos usar o <code>preventDefault()</code>.</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            btnEnviar.onclick = e => {<br /><br />
                            <span class="ml-3">e.preventDefault()</span><br />
                            <span class="ml-3">confirmado = confirm(`<br />
                                <span class="ml-5">Antes de enviar seu formulário, gostaríamos de confirmar seus dados:\n</span><br />
                                <span class="ml-5">Nome: ${nome.value} ${sobrenome.value}\n</span><br />
                                <span class="ml-5">Email: ${email.value}\n</span><br />
                                <span class="ml-3">`)</span><br />
                                <span class="ml-3">confirmado && formulario.submit()</span><br /><br />
                                }
                        </code>
                    </div>
                </li>
            </ul>
            <p class="mt-3">E aí, vamos fazer uma consulta à uma API?</p>
        </article>
        <article class="col-12 mx-auto my-4">
            <h2 class="col-12">Prática 25 | Consulta à API ViaCEP</h2>
            <ul class="col-12 py-3">
                <li class="my-5">
                    <h5>Atributo <code>onblur</code> do <code>input</code> do CEP</h5>
                    <p class="mt-3">Mesmo sem termos definido a função que será executada para buscar o endereço a partir do CEP, vamos deixar isso pronto desde já.</p>
                    <p class="mt-3">Vamos definir também um mínimo e máximo de dígitos para deixarmos 'no jeito' o CEP.</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            cep.setAttribute('onblur', 'pesquisarCep(this.value)')<br />
                            cep.setAttribute('minlength', '8')<br />
                            cep.setAttribute('maxlength', '9')<br />
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Endpoint do ViaCEP</h5>
                    <p class="mt-3">Agora vamos criar um script que define a URL que será chamada para consultarmos o endereço a partir do CEP</p>
                    <p class="mt-3">E também a nomearemos a função <i>callback</i> (a ser executada ao recebermos o retorno).</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            function pesquisarCep( el ) {<br /><br />
                            <span class="ml-3">// Limpando o CEP e deixando apenas números</span><br />
                            <span class="ml-3">let cepLimpo = el.replace(/\D/g,'')</span><br /><br />
                            <span class="ml-3">// Garantindo que o CEP não está vazio e está no formato esperado</span><br />
                            <span class="ml-3">let formatoCep = /^[0-9]{8}$/</span><br /><br />
                            <span class="ml-3">if ( cepLimpo !== '' && formatoCep.test(cepLimpo) ) {</span><br /><br />
                            <span class="ml-5">// Mostrando que os campos serão populados</span><br />
                            <span class="ml-5">endereco.value = '...'</span><br />
                            <span class="ml-5">bairro.value = '...'</span><br />
                            <span class="ml-5">cidade.value = '...'</span><br />
                            <span class="ml-5">estado.value = '...'</span><br /><br />
                            <span class="ml-5">/**</span><br />
                            <span class="ml-5"> * ### IMPORTANTE ###</span><br />
                            <span class="ml-5"> * Criando o endpoint do ViaCEP</span><br />
                            <span class="ml-5"> * <span class="text-white">callback=retorno_callback_viacep</span> é o parâmetro (do tipo query param)</span><br />
                            <span class="ml-5"> * que chama a nossa função callback a partir do recebimento do retorno</span><br />
                            <span class="ml-5"> *</span><br />
                            <span class="ml-5"> */</span><br /><br />
                            <span class="ml-5">scriptCep = document.createElement('script')</span><br />
                            <span class="ml-5">scriptCep.src = `https://viacep.com.br/ws/${cepLimpo}/json/?callback=retorno_callback_viacep`</span><br />
                            <span class="ml-5">document.querySelector('head').appendChild(scriptCep)</span><br /><br />
                            <span class="ml-3">}</span><br /><br />
                            }
                        </code>
                    </div>
                </li>
                <li class="my-5">
                    <h5>Função Callback</h5>
                    <p class="mt-3">E finalmente vamos popular nosso formulário com a resposta/retorno (ou <i>response</i>) vindo da API! Uhuuu!</p>
                    <div class="bg-dark p-5">
                        <code class="font-weight-bold">
                            function retorno_callback_viacep(resposta) {<br /><br />
                            <span class="ml-2">// Caso não haja erros...</span><br />
                            <span class="ml-2">if ( !('erro' in resposta) ) {</span><br /><br />
                            <span class="ml-4">// Populamos os campos</span><br />
                            <span class="ml-4">endereco.value = resposta.logradouro</span><br />
                            <span class="ml-4">bairro.value = resposta.bairro</span><br />
                            <span class="ml-4">cidade.value = resposta.localidade</span><br /><br />
                            <span class="ml-4">// E no caso da UF</span><br />
                            <span class="ml-4">let estados = formulario.querySelectorAll('option')</span><br />
                            <span class="ml-4">for(cadaEstado of estados){</span><br /><br />
                                <span class="ml-5">cadaEstado.value === resposta.uf</span><br />
                                <span class="ml-5">&& cadaEstado.setAttribute('selected','')</span><br /><br/>
                            <span class="ml-4">}</span><br /><br />
                            <span class="ml-4">// E direcionamos o usuário para o campo de número</span><br />
                            <span class="ml-4">numero.focus()</span><br /><br />
                            <span class="ml-2">} else {</span><br /><br />
                                <span class="ml-4">// Se der erro, avisamos o usuário, limpamos os campos e focamos no campo CEP novamente</span><br />
                                <span class="ml-4">alert('\nOps!\n\nInfelizmente não encontramos esse CEP...\n\nPor favor, verifique o CEP inserido\n\n')</span><br />
                                <span class="ml-4">endereco.value = ''</span><br />
                                <span class="ml-4">bairro.value = ''</span><br />
                                <span class="ml-4">cidade.value = ''</span><br />
                                <span class="ml-4">estado.value = ''</span><br />
                            <span class="ml-2">}</span><br /><br />
                            }
                        </code>
                    </div>
                </li>
            </ul>
            <p class="mt-3">Confiram o arquivo <a href="https://github.com/Marcelo-Diament/tn01-js-aula-02/blob/master/README.md" target="_blank" rel="noopener noreferrer" title="Veja o arquivo readme.md">README.md</a> do repositório para verem maiores informações.</p>
        </article>
    </section>
    <footer class="col-12 row mb-3">
        <a href="./prevent-default.html" class="w-25 btn btn-dark d-inline-block mr-auto mt-4 mb-3" id="voltarBtn"><i class="fas fa-chevron-left"></i> <b class="ml-4">Voltar</b></a>
        <a href="./index.html" class="w-25 btn btn-dark d-inline-block ml-auto mt-4 mb-3" id="avancarBtn"><b>Início</b> <i class="fas fa-chevron-right"></i></a>
    </footer>
</main>
<footer class="container-fluid bg-dark">
    <div class="row">
        <p class="col-12 text-white text-center p-3">JS | AULA II</p>
    </div>
</footer>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="./assets/js/script.js"></script>
</body>

</html>